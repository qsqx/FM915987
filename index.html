<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> </head>
	<link rel="stylesheet" href="./bootstrap-3.3.5-dist/css/bootstrap.min.css">
	<script src="./jquery.min.js"></script>
	<script src="./bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="./fm.css">
	<style type="text/css">
	</style>
</head>
<body >
	<div id='main-container' style="">
		<div id="list-container">
			<div class="list-group">			
			</div>
		</div>
		<div class="frontpage-container profile-container">
			<div class="frontpage profile">
				<div id="frontpage-label-container">
					<h1 >FM915987 在爱的路上千万里</h1>
					<h4>愿我的音乐和故事可以为你的寂静夜晚带来一点温暖。</h4>
					<p>新浪微博:喜欢狐狸的松鼠</p>
					<p>微信:1823708607</p>
					<button type="button" class="btn btn-primary btn-lg" aria-label="Left Align" id="spread">立即收听</button>
				</div>
			</div>
			<div class="profile-detail" style="display:none;margin:0px 20px">
				<p>FM915987 在爱的路上千万里</p>
				<p style="font-size:14px">愿我的音乐和故事可以为你的寂静夜晚带来一点温暖。</p>
				<p style="font-size:12px"> 新浪微博:喜欢狐狸的松鼠</p>
				<p style="font-size:12px"> 微信:1823708607</p>
			</div>
		</div>
	</div>
	<div><audio id='player' style="width:0px;height:0px"></audio></div>
	<div class="preload" style="display:none">
		<img src="17105288983053444_320x320.png"></img>
	</div>
	<div class="template" style="display:none">
		<div id="template-playlist">
			<li class="list-group-item playlist-item"><div class="row">
	  					<div class="col-xs-1"><p class="playlist-button button item-button">play</p> 	</div>
	  					<div class="col-xs-7"><p class="playlist-title">title</p></div>
	  					<div class="col-xs-2"><p class="playlist-published">published</p><p class="playlist-label-published">published</p></div>
	  					<div class="col-xs-2"><p class="playlist-duration">duration</p><p class="playlist-label-duration">duration</p></div>
			</div></li>
		</div>
		<div id="template-playcard">
			<li class="list-group-item playcard" ><div class="row">
				<div class="col-xs-4 " >
					<img src="disc.png" class="disc"></img>
					<img src="magnetic.png" class="magnetic"></img>
				</div>
				<div class="col-xs-8 playcard-right">
					<div class="playcard-title"><p>【故事专题】我想陪着你，不管从前还是以后</p></div>
					<div class="playcard-progress" >
						<div class="progress" >
						  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="background-color:green">
						    <span class="sr-only"></span>
						  </div>
						</div>
						</div>
						<div class="time-remain" >-12'34"</div>
						<div class="controls">
							<p>
  							<span class="glyphicon glyphicon-fast-backward button backward-button" aria-hidden="true"></span>
  							<span style="padding:0px 20px; "></span>
  							<span class="glyphicon glyphicon-pause button play-pause-button" aria-hidden="true"></span>
  							<span style="padding:0px 20px;"></span>
  							<span class="glyphicon glyphicon-fast-forward button forward-button" aria-hidden="true"></span>
							</p>
						</div>
				</div>
			</div>
			</li>
		</div>
	</div>

<script src='./fm.js'></script>
<script>
	function setList(obj){
		arr=obj.list;
		var l=$('#list-container .list-group');
		for(var i in obj.list){
			l.append('<li class="list-group-item playlist-item" id=\"item-'+i+'\">'+getPlaylist(obj.list[i],i)+'</li>');
		}
	}
</script>
<script>
	var player={
		q:null,
		dom:null,
		isPlaying:false,
		getSrc:function(url){
			var src="";
			for(var i in url){
				src+='<source src=\"'+url[i]+'\" type=\"audio/'+i+'\">';
			}
			console.log(src);
			return src;
		},
		setMedia:function(url){
			this.q.empty();
			this.q.html(this.getSrc(url));
			return this;
		},
		play:function(){
			this.isPlaying=true;
			this.dom.play();
		},
		pause:function(){
			this.isPlaying=false;
			this.dom.pause();
		},
		getCurrentTime:function(){
			return this.dom.currentTime;
		},
		getCurrentPercent:function(){
			return this.dom.currentTime/this.dom.duration*100;
		},
		getBufferedLength:function(){
			return this.dom.buffered.length?this.dom.buffered.end(0):0;
		},
		getBufferedPercent:function(){
			return this.getBufferedLength()/this.dom.duration*100;
		},
		formatTime: function(t){
			t=Math.floor(t);
			if(t>=60){
				return Math.floor(t/60)+'\''+t%60+'\"';
			}
			else{
				return t%60+'\"';
			}
		}
	}
	function getPlaylist(item,id){
		$('#template-playlist .playlist-title').html(item.title);
		$('#template-playlist .playlist-published').html(item.published);
		$('#template-playlist .playlist-duration').html(item.duration);
		$('#template-playlist .playlist-button').attr('id','pb-'+id);
		var html=$('#template-playlist .playlist-item').html();
		$('#template-playlist .playlist-button').removeAttr('id');
		return html;
	}
	function getPlaycard(item){
		$('#template-playcard .playcard-title').html(item.title);
		var html=$('#template-playcard .playcard').html();
		console.log(item.title);
		return html;
	}
	function spreadToCard(id){
		$('#item-'+id).html(getPlaycard(arr[id])).removeClass('playlist-item').addClass('playcard');
		playnw=id;
	}
	function retractToItem(){
		if(playnw!=null){
			$('#item-'+playnw).html(getPlaylist(arr[playnw],playnw)).removeClass('playcard').addClass('playlist-item');
		}
	}
	
	
</script>
<script>
	$(document).ready(function(){
		player.q=$('#player');
		player.dom=player.q[0];
		player.q.on('ended',function(){
			$('.play-pause-button').toggleClass('glyphicon-pause').toggleClass('glyphicon-play');
			player.isPlaying=false;
		});
		setInterval(function(){
			//console.log(player.getBufferedPercent());
			//console.log(player.getCurrentPercent());
		},500);
	});
	$(document).ready(function(){
		$('#list-container').on('click',function(event){
			var tar=$(event.target);
			if(tar.hasClass('item-button')){
				var id=tar.attr('id');
				id=/[0-9]+/.exec(id)[0];
				id=parseInt(id);
				retractToItem();
				spreadToCard(id);
				player.setMedia(arr[id].url).play();
			}
			else if(tar.hasClass('play-pause-button')){
				if(player.isPlaying){
					player.pause();
				} 
				else{
					player.play();
				} 
				tar.toggleClass('glyphicon-pause').toggleClass('glyphicon-play');
			}
		});
	});
</script>
<script src="json.js"></script>

</body>
</html>